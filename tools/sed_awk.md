# SED & AWK ä»‹ç»

æˆ‘ä»¬è¿ç»´å›¢é˜Ÿå› ä¸ºç»å¸¸è¦åˆ†æå’Œæ ¼å¼åŒ–æ—¥å¿—æ–‡ä»¶ï¼Œä½†åˆä¸ä¹ æƒ¯å‘½ä»¤è¡Œä¸‹çš„å¤„ç†å·¥å…·ï¼Œæ‰€ä»¥å¤„ç†æ•ˆç‡å®åœ¨ä¸é«˜ã€‚ä¸ºäº†å¸®åŠ©å¤§å®¶æé«˜å·¥ä½œæ•ˆç‡ï¼Œæˆ‘ä»è‡ªå·±ä½¿ç”¨ç»éªŒå‡ºå‘ï¼Œæ•´ç†äº†ä¸¤ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œæµå¤„ç†å·¥å…· **SED** å’Œ **AWK** ç®€å•å®ç”¨æ–¹æ³•ï¼Œå¸Œæœ›èƒ½æœ‰å¸®åŠ©ã€‚

## SED

SEDè¯ç”Ÿè‡ªunixæ—©æœŸï¼Œç”±unixå‘æ˜äººç¼–å†™ï¼Œå¯ä»¥è¯´æ˜¯æ ¹æ­£è‹—çº¢çš„å¤§ä½¬çº§å·¥å…·ã€‚SEDå…¨åæ˜¯*stream editor*ï¼Œä¹Ÿå°±æ˜¯æµç¼–è¾‘å™¨ï¼Œä»åå­—ä¸Šä¹Ÿèƒ½çœ‹å‡ºæ¥è¿™ä¸ªç¼–è¾‘å™¨å¤„ç†æ–‡æœ¬çš„æ–¹å¼æ˜¯è¾¹è¯»è¾¹å¤„ç†ï¼Œä¸€æ¬¡å¤„ç†ä¸€è¡Œå†…å®¹ã€‚å¯ä»¥ç†è§£ï¼Œå½“å¹´æœºå­å†…å­˜é‚£ä¹ˆå°ï¼Œä¸€ä¸‹æŠŠæ–‡æœ¬éƒ½è¯»è¿›å»ï¼Œç›´æ¥å¡æ­»å•¥ä¹Ÿç”­æƒ³å¹²äº†ã€‚SEDæœ¬èº«é€»è¾‘éå¸¸ç®€å•ï¼Œèƒ½ç©å‡ºèŠ±æ ·çš„åœ°æ–¹å°±æ˜¯æ­£åˆ™éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸€å®šè¦å…ˆå­¦ä¼šæ­£åˆ™ï¼Œå†æ¥å­¦SEDã€‚æœ¬æ–‡ä¸ä¼šä»‹ç»æ­£åˆ™åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿä¸æ‰“ç®—ç³»ç»Ÿæ€§åœ°è®²è§£SEDï¼ˆä¸»è¦æ˜¯å¯è®²çš„ä¸œè¥¿å¤ªå¤šäº†ï¼‰ï¼Œå¦‚æœæƒ³ç³»ç»Ÿæ€§å­¦ä¹ ï¼Œå¯ä»¥å‚è€ƒ[SEDæ‰‹å†Œ](http://www.gnu.org/software/sed/manual/sed.html)ï¼Œè¿™æ˜¯GNUç‰ˆçš„ï¼Œè¿˜æœ‰ä¸€ä¸ªBSDç‰ˆçš„ä¹Ÿæ¯”è¾ƒæµè¡Œï¼Œè¿™ä¸¤æ¬¾åœ¨è¯­æ³•ä¸Šæœ‰äº›å·®å¼‚ã€‚

### Hello World

é€šå¸¸Hello Worldæ˜¯ä»é™Œç”Ÿåˆ°ç†Ÿæ‚‰çš„å…³é”®ä¸€æ­¥ï¼Œè¿™é‡Œç®€å•åœ°æ¼”ç¤ºä¸‹å¦‚ä½•æ›¿æ¢æ–‡æœ¬æ–‡å­—ï¼Œå¸®å¤§å®¶ç†Ÿæ‚‰SEDé£æ ¼ã€‚
æˆ‘ä»¬å…ˆå‡†å¤‡ä¸€æ®µæµ‹è¯•æ–‡æœ¬:

```bash
$ cat test.txt
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
2020-5-25 200 client's name is firefox
2020-5-25 200 client's name is w3m
```

ç„¶åæŠŠå…¶ä¸­çš„clientæ”¹æˆbrowserã€‚

```bash
sed "s/client/browser/g" test.txt
```

éå¸¸ç¬¦åˆ*nixé£æ ¼ï¼Œå¾ˆå¥½ç†è§£ï¼š`s`è¡¨ç¤ºæ›¿æ¢å‘½ä»¤ï¼Œç¬¬ä¸€ä¸ª`/***/`è¡¨ç¤ºè¦åŒ¹é…çš„è‡ªè´Ÿï¼Œç¬¬äºŒä¸ª`/***/`è¡¨ç¤ºæŠŠåŒ¹é…æ›¿æ¢æˆä»€ä¹ˆï¼Œ`g`è¡¨ç¤ºä¸€è¡Œä¸Šçš„æ›¿æ¢æ‰€æœ‰çš„åŒ¹é…ã€‚scriptä¹Ÿå¯ä»¥ç”¨å•å¼•å·`'`ï¼Œä½†è¦æ³¨æ„ï¼Œæ— æ³•ç”¨è½¬ä¹‰å­—ç¬¦è¡¨ç¤ºå•å¼•å·ï¼Œä¾‹å¦‚ã€‚

```bash
sed "s/client's/my/g" test.txt
```

æ¥ä¸ªå®é™…çš„ä¾‹å­ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦ç»Ÿè®¡æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ç±»å‹ï¼Œå¯ä»¥è¿™ä¹ˆæ“ä½œï¼š

```bash
find / -type f | sed 's/.*\.//' | sort -u
```

ä¸Šé¢çš„æ“ä½œä»…ä»…åœ¨ç»ˆç«¯æ‰“å°äº†ç»“æœï¼Œä½†å¹¶æ²¡æœ‰æ”¹å˜æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœæƒ³ä¿å­˜ç»“æœï¼Œå¯ä»¥ç”¨é‡å®šå‘

```bash
sed "s/client/browser/g" test.txt > result.txt
```

æˆ–ç›´æ¥ä¿®æ”¹åŸå§‹æ–‡ä»¶

```bash
sed -i "s/client/browser/g" test.txt
```

SEDä½¿ç”¨æ ‡å‡†æ­£åˆ™ï¼Œæƒ³äº†è§£è¯¦ç»†æ­£åˆ™è§„èŒƒï¼Œå¯ä»¥å‚ç…§[SEDå¸®åŠ©](http://www.gnu.org/software/sed/manual/sed.html#Regular-Expressions-Overview)ã€‚ç»§ç»­ä¸¾ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦åœ¨æ¯è¡Œå¼€å¤´åŠ ç‚¹ä¸œè¥¿ï¼Œå¯ä»¥è¿™ä¹ˆåšã€‚

```bash
$ sed "s/^/- /g" test.txt
- 2020-5-25 200 client's name is ie
- 2020-5-25 200 client's name is safari
- 2020-5-25 200 client's name is chrome
- 2020-5-25 200 client's name is firefox
- 2020-5-25 200 client's name is w3m
```

### é™å®šèŒƒå›´

æœ‰æ—¶æˆ‘ä»¬ä¸éœ€è¦å…¨æ–‡æ›¿æ¢ï¼Œå¯ä»¥åœ¨sedé‡Œé™å®šå¥½èŒƒå›´ï¼Œæ¯”å¦‚åªç»™ç¬¬3è¡Œç»“å°¾åŠ ä¸Šçœç•¥å·ï¼š

```bash
$ sed "3s/$/ .../g" test.txt
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome ...
2020-5-25 200 client's name is firefox
2020-5-25 200 client's name is w3m
```

åªæ›¿æ¢ç¬¬3~4è¡Œçš„æ–‡æœ¬ï¼š

```bash
$ sed "3,4s/client's/my/g" test.txt
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 my name is chrome
2020-5-25 200 my name is firefox
2020-5-25 200 client's name is w3m
```

æŠŠæ¯è¡Œç¬¬2ä¸ªiæ”¹ä¸ºIï¼š

```bash
$ sed "s/i/I/2" test.txt
2020-5-25 200 client's name Is ie
2020-5-25 200 client's name Is safari
2020-5-25 200 client's name Is chrome
2020-5-25 200 client's name Is firefox
2020-5-25 200 client's name Is w3m
```

æŠŠç¬¬ä¸€è¡Œçš„ç¬¬3ä¸ªåŠä»¥åçš„0æ›¿æ¢æˆ*ï¼š

```bash
$ sed '1s/0/*/3g' test.txt
2020-5-25 2** client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
2020-5-25 200 client's name is firefox
2020-5-25 200 client's name is w3m
```

### ç»„åˆåŒ¹é…

å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ›¿æ¢å¤šä¸ªæ¨¡å¼ï¼Œå¯è¯•è¯•ç»„åˆåŒ¹é…ï¼Œæ¯”å¦‚æ¯è¡Œç¬¬2ä¸ªiæ”¹ä¸ºIï¼ŒåŒæ—¶æŠŠç¬¬ä¸€è¡Œçš„ç¬¬3ä¸ªåŠä»¥åçš„0æ›¿æ¢æˆ*ï¼š

```bash
$ sed "s/i/I/2; 1s/0/*/3g" test.txt
2020-5-25 2** client's name Is ie
2020-5-25 200 client's name Is safari
2020-5-25 200 client's name Is chrome
2020-5-25 200 client's name Is firefox
2020-5-25 200 client's name Is w3m
```

ä»¥ä¸Šå‘½ä»¤ç­‰ä»·äºï¼š

```bash
$ sed -e "s/i/I/2" -e "1s/0/*/3g" test.txt
2020-5-25 2** client's name Is ie
2020-5-25 200 client's name Is safari
2020-5-25 200 client's name Is chrome
2020-5-25 200 client's name Is firefox
2020-5-25 200 client's name Is w3m
```

### æå–å˜é‡

æ¯”å¦‚æˆ‘ä»¬æƒ³ç”¨[]æ‹¬èµ·æ¥clientçš„åå­—ï¼Œå¯ä»¥ä½¿ç”¨`&`å½“ä½œè¢«åŒ¹é…çš„å˜é‡ï¼š

```bash
$ sed 's/\<\w*\>$/[&]/g' test.txt
2020-5-25 200 client's name is [ie]
2020-5-25 200 client's name is [safari]
2020-5-25 200 client's name is [chrome]
2020-5-25 200 client's name is [firefox]
2020-5-25 200 client's name is [w3m]
```

å¦‚æœæƒ³æå–å‡ºæ¥æ‰€æœ‰clientçš„åå­—ï¼Œå¯ä»¥ç”¨`()`åŒ¹é…ï¼Œç”¨`\` + æ•°å­—è·å–ç¬¬Nå¯¹`()`çš„åŒ¹é…ç»“æœï¼š

```bash
$ sed 's/.*\(\<\w*\>$\)/\1/g' test.txt
ie
safari
chrome
firefox
w3m
```

æ³¨æ„ï¼Œæ‹¬å·å¿…é¡»ç”¨`\`è½¬ä¹‰ï¼Œå¦åˆ™sedæ— æ³•æ‰¾åˆ°åŒ¹é…å†…å®¹ï¼ŒæŠ¥`invalid reference`é”™è¯¯ã€‚

### å¸¸ç”¨å‚æ•°

- **aå’Œi**

ç±»ä¼¼vimä¸­çš„aå’Œiï¼Œsedé‡Œæ˜¯æ“ä½œè¡Œçš„

```bash
# åœ¨ç¬¬ä¸€è¡Œå‰æ’å…¥ä¸€è¡Œ
$ sed '1i Insert a line.' test.txt
Insert a line.
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
2020-5-25 200 client's name is firefox
2020-5-25 200 client's name is w3m

# åœ¨firefoxæ‰€åœ¨è¡Œåè¿½åŠ ä¸€è¡Œ
$ sed '/firefox/a Insert a line.' test.txt
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
2020-5-25 200 client's name is firefox
Insert a line.
2020-5-25 200 client's name is w3m
```

- **c**

ç±»ä¼¼vimä¸­çš„cå‘½ä»¤ï¼Œsedä¸­å¯ä»¥æ›¿æ¢åŒ¹é…åˆ°çš„è¡Œã€‚

```bash
# æ›¿æ¢firefoxæ‰€åœ¨è¡Œ
$ sed '/firefox/c The replaced line.' test.txt
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
The replaced line.
2020-5-25 200 client's name is w3m
```

- **d**

ç±»ä¼¼vimä¸­çš„då‘½ä»¤ï¼Œsedä¸­å¯ä»¥åˆ é™¤åŒ¹é…åˆ°çš„è¡Œã€‚

```bash
# åˆ é™¤firefoxæ‰€åœ¨è¡Œ
$ sed '/firefox/d' test.txt
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
2020-5-25 200 client's name is w3m
```

- **p**

è¾“å‡ºåŒ¹é…åˆ°çš„è¡Œã€‚

```bash
# è¾“å‡ºfirefoxæ‰€åœ¨çš„è¡Œ
$ sed -n '/firefox/p' test.txt
2020-5-25 200 client's name is firefox
```

æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬åŠ äº†ä¸ª`-n`å‚æ•°ï¼Œä¿è¯åªè¾“å‡ºè¢«é€‰ä¸­çš„è¡Œï¼Œå¦åˆ™sedä¼šè¾“å‡ºæ‰€æœ‰å¤„ç†è¿‡çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼š

```bash
$ sed '/firefox/p' test.txt
2020-5-25 200 client's name is ie
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
2020-5-25 200 client's name is firefox
2020-5-25 200 client's name is firefox
2020-5-25 200 client's name is w3m
```

è¾“å‡ºä»safariåˆ°firefoxçš„è¡Œï¼š

```bash
$ sed -n '/safari/,/firefox/p' test.txt
2020-5-25 200 client's name is safari
2020-5-25 200 client's name is chrome
2020-5-25 200 client's name is firefox
```

### æ‰©å±•ç†è§£

é¦–å…ˆsedçš„å‘½ä»¤è„šæœ¬æ ¼å¼éƒ½æ˜¯è¿™æ ·çš„ï¼š `[address[,address]]function`ã€‚æ‰€è°“`function`å°±æ˜¯å‚æ•°åé¢çš„ä¸€ä¸ªå­—æ¯å‘½ä»¤ã€‚

#### Addresses

addresså¯ä»¥æ˜¯ä¸ªåè¿›åˆ¶æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ¨¡å¼ï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”è¡¨ç¤ºä¸¤ä¸ªaddressåŒºé—´ã€‚

1. å¯¹äºåƒ`addr1,addr2`è¿™ç§å½¢å¼çš„åœ°å€åŒ¹é…ï¼Œå¦‚æœaddr1åŒ¹é…ï¼Œåˆ™åŒ¹é…æˆåŠŸï¼Œ**å¼€å…³**æ‰“å¼€ï¼Œåœ¨è¯¥è¡Œä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œæ­¤æ—¶ä¸ç®¡addr2æ˜¯å¦åŒ¹é…ï¼Œå³ä½¿addr2åœ¨addr1è¿™ä¸€è¡Œä¹‹å‰ã€‚

1. æ¥ä¸‹æ¥è¯»å…¥ä¸‹ä¸€è¡Œï¼Œçœ‹addr2æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœaddr2åœ¨addr1ä¹‹å‰ï¼Œåˆ™ä¸åŒ¹é…ï¼Œä¸æ‰§è¡Œå‘½ä»¤ï¼Œå…³é—­**å¼€å…³**ã€‚å¦‚æœaddr2åŒ¹é…ï¼Œåˆ™æ‰§è¡Œå‘½ä»¤ï¼ŒåŒæ ·å¼€å…³**å…³é—­**ã€‚å¦‚æœaddr2åœ¨addr1ä¹‹åï¼Œåˆ™ä¸€ç›´å¤„ç†åˆ°åŒ¹é…ä¸ºæ­¢ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœaddr2ä¸€ç›´ä¸åŒ¹é…ï¼Œåˆ™å¼€å…³ä¸€ç›´ä¸å…³é—­ï¼Œå› æ­¤ä¼šæŒç»­æ‰§è¡Œå‘½ä»¤åˆ°æœ€åä¸€è¡Œã€‚

#### Pattern Space & Hold Space

sedå¤„ç†æ—¶ï¼Œä¼šæŠŠå½“å‰å¤„ç†çš„è¡Œå­˜å‚¨åœ¨ä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œç§°ä¸º**æ¨¡å¼ç©ºé—´**ï¼ˆpattern spaceï¼‰ï¼Œæ¥ç€ç”¨sedå‘½ä»¤å¤„ç†ç¼“å†²åŒºä¸­çš„å†…å®¹ï¼Œå¤„ç†å®Œæˆåï¼ŒæŠŠç¼“å†²åŒºçš„å†…å®¹æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œæœ€åæ¸…ç©ºç¼“å†²åŒºç»§ç»­å¤„ç†ä¸‹ä¸€è¡Œï¼Œè¿™æ ·ä¸æ–­é‡å¤ç›´åˆ°æ–‡ä»¶æœ«å°¾ã€‚è€Œ**ä¿æŒç©ºé—´**ï¼ˆhold spaceï¼‰åˆ™æ˜¯sedä¸­çš„å¦å¤–ä¸€ä¸ªç¼“å†²åŒºï¼Œæ­¤ç¼“å†²åŒºä¸ä¼šè‡ªåŠ¨æ¸…ç©ºï¼Œä½†ä¹Ÿä¸ä¼šä¸»åŠ¨æŠŠå†…å®¹æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºä¸­ã€‚è€Œæ˜¯éœ€è¦ä»¥ä¸‹sedå‘½ä»¤è¿›è¡Œå¤„ç†ï¼š

- gï¼šå°†hold spaceä¸­çš„å†…å®¹æ‹·è´åˆ°pattern spaceä¸­ï¼ŒåŸæ¥pattern spaceé‡Œçš„å†…å®¹æ¸…é™¤
- Gï¼šå°†hold spaceä¸­çš„å†…å®¹appendåˆ°pattern space\nå
- hï¼šå°†pattern spaceä¸­çš„å†…å®¹æ‹·è´åˆ°hold spaceä¸­ï¼ŒåŸæ¥çš„hold spaceé‡Œçš„å†…å®¹è¢«æ¸…é™¤
- Hï¼šå°†pattern spaceä¸­çš„å†…å®¹appendåˆ°hold space\nå
- xï¼šäº¤æ¢pattern spaceå’Œhold spaceçš„å†…å®¹

ä¸€ä¸ªä½¿ç”¨hold spaceå¸¸è§çš„ä¾‹å­å°±æ˜¯å¦‚ä½•ååºè¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸ªæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```bash
$ cat tt.txt
1
2
3
```

å¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤ååºè¾“å‡ºæ–‡ä»¶å†…å®¹ï¼š

```bash
$ sed '1!G;h;$!d' tt.txt
3
2
1
```

åˆ©ç”¨åå¤æ‹·è´å’Œè¦†ç›–pattern spaceåŠhold spaceçš„æ–¹å¼å®ç°ååºæ–‡ä»¶å†…å®¹ï¼Œæœ€åæŠŠç»“æœæ‹·è´åˆ°pattern spaceä¸­ï¼Œè®©sedè‡ªåŠ¨è¾“å‡ºã€‚æµç¨‹å›¾æ¥è‡ª[é…·å£³](https://coolshell.cn)<br/>![æµç¨‹å›¾](https://coolshell.cn/wp-content/uploads/2013/02/sed_demo.jpg)<br/>è“è‰²ä¸ºpattern spaceï¼Œç»¿è‰²ä¸ºhold spaceã€‚


## AWK

AWKæ˜¯ä¸€ç§æ–‡æœ¬å¤„ç†å’Œæ¨¡å¼åŒ¹é…è¯­è¨€ï¼Œå®ƒæ¯”SEDæ™šå‡ å¹´è¯ç”Ÿï¼ŒåŸºæœ¬å’ŒCæ˜¯åŒæ—¶ä»£çš„äº§ç‰©ï¼Œå¹¶ä¸”å®ƒçš„ä¸‰ä½ä½œè€…ä¹‹ä¸€Brian Kernighanï¼Œå³æ˜¯unixçš„å‘æ˜äººä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æœ¬Cè¯­è¨€æ•™ç¨‹çš„ç¼–å†™è€…ï¼Œæ‰€ä»¥awkè¯­æ³•é£æ ¼éå¸¸ç±»ä¼¼Cè¯­è¨€ã€‚AWKæ“…é•¿äºå¤„ç†æ•°æ®åº“å’Œè¡¨å‹æ•°æ®ï¼Œå¦‚ä»å¤šä¸ªæ•°æ®é›†ä¸­æå–ä¸€äº›åˆ—ã€å»ºç«‹æŠ¥è¡¨æˆ–åˆ†ææ•°æ®ã€‚äº‹å®ä¸Šï¼ŒAWKé€‚åˆäºç¼–å†™çŸ­å°çš„ã€ä¸€æ¬¡æ€§ç¨‹åºï¼Œä»¥æ‰§è¡Œä¸€äº›çµæ´»çš„æ–‡æœ¬å¤„ç†ï¼Œè€Œä½¿ç”¨å…¶ä»–çš„è¯­è¨€åˆ™å¯èƒ½æˆæœ¬è¾ƒé«˜ã€‚å¦å¤–ï¼Œä½œä¸ºä¸€ç§åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼ŒAWKå¸¸å¸¸åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨æˆ–ä¸ç®¡é“ä¸€èµ·ä½¿ç”¨ã€‚

AWKé—®ä¸–ä»¥æ¥å‘å±•å‡ºå¤šä¸ªç‰ˆæœ¬ï¼Œç°å¦‚ä»Šæˆ‘ä»¬å¸¸ç”¨çš„GAWKï¼ˆGNU AWKï¼‰ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š

- æ²¡æœ‰é¢„å®šä¹‰çš„å†…å­˜é™åˆ¶ã€‚
- å¯ä»¥ä½¿ç”¨ç‰¹æ®Šæ–‡ä»¶æ”¯æŒæ¥è®¿é—®æ ‡å‡†çš„*NIXæµã€‚
- å¯ä»¥ä½¿ç”¨Lintæ£€æŸ¥ã€‚
- é»˜è®¤ä½¿ç”¨æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
- æ”¯æŒæ— é™åˆ¶çš„è¡Œé•¿åº¦å’Œè¿ç»­ä½¿ç”¨åæ–œæ å­—ç¬¦ã€‚
- åŒ…å«ä¸€äº›TCP/IPç½‘ç»œå‡½æ•°ã€‚

æ— è®ºå“ªä¸ªç‰ˆæœ¬çš„AWKï¼Œéƒ½æ˜¯æŒ‰è¡Œè¯»å–æ–‡ä»¶/æ ‡å‡†è¾“å…¥æµå†…å®¹ã€‚

### Hello&nbsp;&nbsp;World

äº†è§£åŸºæœ¬æ¦‚å¿µåï¼Œå½“ç„¶æ˜¯åŠ¨æ‰‹å°è¯•äº†ã€‚ä¾‹å¦‚æˆ‘ä»¬`netstat -antpl > netstat.txt`ç”Ÿæˆä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œæƒ³è¦è·å–åè®®ï¼ˆç¬¬ä¸€åˆ—ï¼‰å’Œæœ¬åœ°åœ°å€ï¼ˆç¬¬å››åˆ—ï¼‰çš„å†…å®¹ï¼Œæ“ä½œæ–¹å¼å¦‚ä¸‹ï¼š

```bash
$ awk '{print $1, $4}' netstat.txt
Active (servers
Proto Local
tcp 0.0.0.0:9003
tcp 172.24.36.24:6379
tcp 0.0.0.0:9004
tcp 0.0.0.0:13004
tcp 0.0.0.0:9005
tcp 127.0.0.1:13005
tcp 0.0.0.0:9006
tcp 0.0.0.0:13006
tcp 0.0.0.0:9999
tcp 0.0.0.0:9007
tcp 0.0.0.0:80
tcp 0.0.0.0:9008
tcp 0.0.0.0:22
tcp 0.0.0.0:443
tcp 127.0.0.1:32000
tcp 0.0.0.0:9001
tcp 0.0.0.0:9002
...
```

é¦–å…ˆçœ‹ç¬¬ä¸€è¡Œæ˜¯æ€ä¹ˆå›äº‹ï¼Ÿçœ‹ä¸‹æ–‡ä»¶ï¼ŒåŸæ¥ç¬¬ä¸€è¡Œä¸ç¬¦åˆawkè·å–åˆ—çš„å®šä¹‰ï¼Œå¯ä»¥ç”¨åˆšå­¦çš„sedå‘½ä»¤ç…ä¸€çœ¼ï¼š

```bash
$ sed -n '1p' netstat.txt
Active Internet connections (servers and established)
```

è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç»“åˆsedï¼Œåªå¤„ç†ä»åœ°äºŒè¡Œå¼€å§‹çš„å†…å®¹ï¼š

```bash
$ sed -n '2,$p' netstat.txt | awk '{print $1, $4}'
Proto Local
tcp 0.0.0.0:9003
tcp 172.24.36.24:6379
tcp 0.0.0.0:9004
tcp 0.0.0.0:13004
tcp 0.0.0.0:9005
tcp 127.0.0.1:13005
tcp 0.0.0.0:9006
tcp 0.0.0.0:13006
tcp 0.0.0.0:9999
tcp 0.0.0.0:9007
tcp 0.0.0.0:80
tcp 0.0.0.0:9008
tcp 0.0.0.0:22
tcp 0.0.0.0:443
tcp 127.0.0.1:32000
tcp 0.0.0.0:9001
tcp 0.0.0.0:9002
...
```

å‘ç°è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œç¬¬å››åˆ—åº”è¯¥æ˜¯*Local Address*ï¼Œæ€ä¹ˆè¿™é‡Œåªå‰©ä¸‹*Local*äº†ï¼ŸåŸæ¥AWKé»˜è®¤åˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ï¼Œå®ƒæ²¡æ³•åŒºåˆ†åˆ—å†…ç©ºæ ¼è¿˜æ˜¯åˆ—é—´ç©ºæ ¼ã€‚æˆ‘ä»¬å¯ä»¥ç”¨sedå…ˆæŠŠåˆ—å†…ç©ºæ ¼æ›¿æ¢æˆåˆ«çš„å­—ç¬¦ï¼Œç„¶åå†è°ƒç”¨AWKï¼š

```bash
$ sed -n '2,$p' netstat.txt| sed '1s/^\(\<\w\+\)\s\+\(\<\w\+\-\w\+\)\s\+\(\<\w\+\-\w\+\)\s\+\(\<\w\+\)\s\(\w\+\).*/\1 \2 \3 \4-\5/g' | awk '{printf "%-8s\t%-18s\n", $1, $4}'
Proto   	Local-Address
tcp     	0.0.0.0:9003
tcp     	172.24.36.24:6379
tcp     	0.0.0.0:9004
tcp     	0.0.0.0:13004
tcp     	0.0.0.0:9005
tcp     	127.0.0.1:13005
tcp     	0.0.0.0:9006
tcp     	0.0.0.0:13006
tcp     	0.0.0.0:9999
tcp     	0.0.0.0:9007
tcp     	0.0.0.0:80
tcp     	0.0.0.0:9008
tcp     	0.0.0.0:22
tcp     	0.0.0.0:443
tcp     	127.0.0.1:32000
tcp     	0.0.0.0:9001
tcp     	0.0.0.0:9002
...
```

å¤§æ‹¬å·é‡Œé¢å°±æ˜¯AWKè¯­å¥ã€‚é¡»æ³¨æ„ï¼Œå¤§æ‹¬å·åªèƒ½è¢«å•å¼•å·åŒ…å«ã€‚å…¶ä¸­çš„$1..$nè¡¨ç¤ºç¬¬å‡ ä¾‹ã€‚ *$0è¡¨ç¤ºæ•´è¡Œ*

å‰é¢è¯´äº†AWKè¯­æ³•éå¸¸ç±»ä¼¼Cï¼Œå…¶ä¸­è®¸å¤šç‰¹æ€§ï¼ŒåŒ…æ‹¬æ§åˆ¶è¯­å¥å’Œå­—ç¬¦ä¸²å‡½æ•°ï¼Œå¦‚`printf`å’Œ`sprintf`ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç›¸åŒçš„ï¼Œæ¯”å¦‚æ ¼å¼åŒ–è¾“å‡º:

```bash
$ sed -n '2,$p' netstat.txt | awk '{printf "%-8s\t%-18s\n", $1, $4}' | more
Proto   	Local
tcp     	0.0.0.0:9003
tcp     	172.24.36.24:6379
tcp     	0.0.0.0:9004
tcp     	0.0.0.0:13004
tcp     	0.0.0.0:9005
tcp     	127.0.0.1:13005
tcp     	0.0.0.0:9006
tcp     	0.0.0.0:13006
tcp     	0.0.0.0:9999
tcp     	0.0.0.0:9007
tcp     	0.0.0.0:80
tcp     	0.0.0.0:9008
tcp     	0.0.0.0:22
tcp     	0.0.0.0:443
tcp     	127.0.0.1:32000
tcp     	0.0.0.0:9001
tcp     	0.0.0.0:9002
...
```

### è¿‡æ»¤è®°å½•

AWKæ›´å¸¸å½“è¿‡æ»¤å™¨æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚è¦æå–å‡ºæ‰€æœ‰ç½‘ç»œå‘é€é˜Ÿåˆ—ä¸ä¸º0ï¼Œå¹¶ä¸”çŠ¶æ€ä¸ºESTABLISHEDçš„è®°å½•ã€‚

```bash
$ awk '$3!=0 && $6=="ESTABLISHED" ' netstat.txt
tcp        0     36 172.24.36.24:22         36.112.91.242:65397     ESTABLISHED 12709/sshd: root@pt
```

é€šå¸¸å¯ä»¥å†åŠ ä¸Šè¡¨å¤´ä¸€èµ·æ‰“å°ï¼Œæ›´æ¸…æ™°äº›ï¼š

```bash
$ awk '$3!=0 && $6=="ESTABLISHED" || NR==2' netstat.txt
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0     36 172.24.36.24:22         36.112.91.242:65397     ESTABLISHED 12709/sshd: root@pt
```

`NR`æ˜¯AWKçš„å†…ç½®å˜é‡ï¼Œè¡¨ç¤ºä»å¼€å§‹è®°å½•çš„è¡Œå·ï¼Œå› ä¸ºnetstat.txtä¸­è¡¨æ ¼ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œæ‰€ä»¥ç­›é€‰æ¡ä»¶æ˜¯`NR==2`ã€‚æœ€ååšç‚¹æ ¼å¼åŒ–è¾“å‡ºï¼š

```bash
$ awk '$3!=0 && $6=="ESTABLISHED" || NR==2 {printf "%-8s\t%-10s\n", $3, $6}' netstat.txt
Send-Q  	Foreign
36      	ESTABLISHED
```

### å†…ç½®å˜é‡

å‰é¢ç”¨`NR`æ¥ç­›é€‰ç‰¹å®šçš„è¡Œï¼ŒAWKæœ‰å¾ˆå¤šå†…ç½®å˜é‡ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æœ‰ï¼š

|å˜é‡|æè¿°|
|--------:|----------:|
|$0|å½“å‰è®°å½•ï¼ˆè¿™ä¸ªå˜é‡ä¸­å­˜æ”¾ç€æ•´ä¸ªè¡Œçš„å†…å®¹ï¼‰ã€‚|
|$1 ~ $n|å½“å‰è®°å½•çš„ç¬¬nä¸ªå­—æ®µï¼Œå­—æ®µé—´ç”±FSåˆ†éš”ã€‚|
|FS|è¾“å…¥å­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼æˆ–Tabã€‚|
|NF|å½“å‰è®°å½•ä¸­çš„å­—æ®µä¸ªæ•°ï¼Œå°±æ˜¯æœ‰å¤šå°‘åˆ—ã€‚|
|NR|å·²ç»è¯»å‡ºçš„è®°å½•æ•°ï¼Œå°±æ˜¯è¡Œå·ï¼Œä»1å¼€å§‹ï¼Œå¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶è¯ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯ä¸æ–­ç´¯åŠ ä¸­ã€‚|
|FNR|å½“å‰è®°å½•æ•°ï¼Œä¸NRä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ªå€¼ä¼šæ˜¯å„ä¸ªæ–‡ä»¶è‡ªå·±çš„è¡Œå·ã€‚|
|RS|è¾“å…¥çš„è®°å½•åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦ã€‚|
|OFS|è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¹Ÿæ˜¯ç©ºæ ¼ã€‚|
|ORS|è¾“å‡ºçš„è®°å½•åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦ã€‚|
|FILENAME|å½“å‰è¾“å…¥æ–‡ä»¶çš„åå­—ã€‚|
|IGNORECASE|å½“ IGNORECASE è®¾ç½®ä¸ºéç©ºå€¼ï¼ŒGAWK å°†å¿½ç•¥æ¨¡å¼åŒ¹é…ä¸­çš„å¤§å°å†™ã€‚|

ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦è¾“å‡ºè¡Œå·ï¼š

```bash
$ awk '$3!=0 && $6=="ESTABLISHED" || NR==2 {printf "%d\t%-8s\t%-10s\n", NR, $3, $6}' netstat.txt
2	Send-Q  	Foreign
66	36      	ESTABLISHED
```

### åˆ¶å®šåˆ†éš”ç¬¦

AWKé»˜è®¤ç”¨ç©ºæ ¼åšåˆ†éš”ç¬¦ï¼Œä½†æ˜¯æœ‰äº›åœºæ™¯ä¸‹æˆ‘ä»¬è¦ç”¨å…¶å®ƒç¬¦å·åšåˆ†éš”ç¬¦ï¼Œæ¯”å¦‚å¦‚æœå¤„ç†/etc/passwdæ–‡ä»¶æ—¶ï¼š

```bash
$ awk  'BEGIN{FS=":"} {print $1,$3,$6}' /etc/passwd
root 0 /root
bin 1 /bin
daemon 2 /sbin
adm 3 /var/adm
lp 4 /var/spool/lpd
sync 5 /sbin
shutdown 6 /sbin
halt 7 /sbin
mail 8 /var/spool/mail
operator 11 /root
games 12 /usr/games
ftp 14 /var/ftp
nobody 99 /
systemd-network 192 /
dbus 81 /
sshd 74 /var/empty/sshd
```

`BEGIN`è¡¨è¾¾å¼ç”¨æ¥ç»™AWKç¨‹åºèµ‹äºˆåˆå§‹çŠ¶æ€ï¼ŒåŒç†è¿˜æœ‰ä¸ª`END`è¡¨è¾¾å¼ï¼Œç”¨æ¥æ‰§è¡Œä¸€äº›æ”¶å°¾å·¥ä½œã€‚ä¸Šè¿°å‘½ä»¤ä¹Ÿç­‰ä»·äºï¼š

```bash
awk  -F: '{print $1,$3,$6}' /etc/passwd
```

å¦‚æœè¦æŒ‡å®šå¤šä¸ªåˆ†éš”ç¬¦ï¼Œå¯ä»¥æ•°ç»„è¡¨ç¤ºï¼š`FS=[:;]`ã€‚

`BEGIN`ä¸­å¯ä»¥æ”¾å¤šæ¡è¯­å¥ï¼Œç”¨`;`åˆ†éš”å³å¯ï¼Œæ¯”å¦‚æˆ‘ä»¬è®¾å®šè¾“å‡ºåˆ†éš”ç¬¦ä¸º`\t`ï¼š

```bash
$ awk 'BEGIN{FS=":"; OFS="\t"} {print $1,$3,$6}' /etc/passwd
root	0	/root
bin	1	/bin
daemon	2	/sbin
adm	3	/var/adm
lp	4	/var/spool/lpd
sync	5	/sbin
shutdown	6	/sbin
halt	7	/sbin
mail	8	/var/spool/mail
operator	11	/root
games	12	/usr/games
ftp	14	/var/ftp
nobody	99	/
systemd-network	192	/
dbus	81	/
sshd	74	/var/empty/sshd
```

ä¸Šé¢è¯­å¥ç­‰ä»·äº

```bash
awk -F: 'OFS="\t" {print $1,$3,$6}' /etc/passwd
```

### å­—ç¬¦ä¸²åŒ¹é…

AWKï¼ˆGAWKï¼‰çš„åŒ¹é…æœºåˆ¶ç±»ä¼¼egrepï¼ŒæŠŠè§„åˆ™ç”¨`//`æ‹¬èµ·æ¥ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æƒ³åŒ¹é…æœ‰*java*å­—æ ·çš„è¡Œï¼š

```bash
awk ' /java/ {print $4,$5,$7}' OFS="\t" netstat.txt
0.0.0.0:9003	0.0.0.0:*	17362/java
0.0.0.0:9004	0.0.0.0:*	9432/java
0.0.0.0:13004	0.0.0.0:*	4982/java
0.0.0.0:9005	0.0.0.0:*	21614/java
127.0.0.1:13005	0.0.0.0:*	4982/java
0.0.0.0:9006	0.0.0.0:*	17485/java
0.0.0.0:13006	0.0.0.0:*	4982/java
0.0.0.0:9007	0.0.0.0:*	17547/java
0.0.0.0:9008	0.0.0.0:*	12472/java
127.0.0.1:32000	0.0.0.0:*	11740/java
0.0.0.0:9001	0.0.0.0:*	24855/java
0.0.0.0:9002	0.0.0.0:*	2787/java
127.0.0.1:31000	127.0.0.1:32000	11740/java
172.24.36.24:13006	194.61.54.237:63544	4982/java
172.24.36.24:36218	172.24.36.24:3306	9432/java
172.24.36.24:60274	172.24.36.24:3306	21614/java
172.24.36.24:60414	172.24.36.24:3306	17547/java
172.24.36.24:60396	172.24.36.24:3306	17362/java
...
```

å¦‚æœæƒ³ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—å†…å®¹ï¼Œå¯ä»¥ç”¨`$n`å˜é‡ï¼š

```bash
$ awk '$7 ~ /java/ {print $4,$5,$7}' OFS="\t" netstat.txt
0.0.0.0:9003	0.0.0.0:*	17362/java
0.0.0.0:9004	0.0.0.0:*	9432/java
0.0.0.0:13004	0.0.0.0:*	4982/java
0.0.0.0:9005	0.0.0.0:*	21614/java
127.0.0.1:13005	0.0.0.0:*	4982/java
0.0.0.0:9006	0.0.0.0:*	17485/java
0.0.0.0:13006	0.0.0.0:*	4982/java
0.0.0.0:9007	0.0.0.0:*	17547/java
0.0.0.0:9008	0.0.0.0:*	12472/java
127.0.0.1:32000	0.0.0.0:*	11740/java
0.0.0.0:9001	0.0.0.0:*	24855/java
0.0.0.0:9002	0.0.0.0:*	2787/java
127.0.0.1:31000	127.0.0.1:32000	11740/java
172.24.36.24:13006	194.61.54.237:63544	4982/java
172.24.36.24:36218	172.24.36.24:3306	9432/java
```

### åŸºç¡€è¯­æ³•
`~`æ˜¯AWKçš„è¿ç®—ç¬¦ï¼Œç”¨æ¥è¿›è¡ŒEREï¼ˆextended regular expressionï¼‰åŒ¹é…çš„ã€‚ä¸‹é¢æ˜¯AWKè¡¨è¾¾å¼ä¼˜å…ˆçº§çš„ä¸€ä¸ªæ’åºè¡¨ï¼ŒåŸºæœ¬å’ŒCè¯­è¨€ä¸€è‡´ï¼š

|è¯­æ³•|åŠŸèƒ½ï¼ˆğŸ„²è¡¨ç¤ºåŒCè¯­è¨€ï¼‰|ç»“æœç±»å‹|è¿ç®—æ–¹å‘|
|----:|----:|----:|
|( expr )|ç»„åˆè¿ç®—|åŒexprç»“æœ|N/A|
|$expr|å¼•ç”¨åˆ—|String|N/A|
|++ lvalue|ğŸ„²|Numeric|N/A|
|-- lvalue|ğŸ„²|Numeric|N/A|
|lvalue ++|ğŸ„²|Numeric|N/A|
|lvalue --|ğŸ„²|Numeric|N/A|
|expr ^ expr|æŒ‡æ•°è¿ç®—|Numeric|â†|
|! expr|ğŸ„²|Numeric|N/A|
|+ expr|ğŸ„²|Numeric|N/A|
|- expr|ğŸ„²|Numeric|N/A|
|expr \* expr|ğŸ„²|Numeric|â†’|
|expr / expr|ğŸ„²|Numeric|â†’|
|expr % expr|ğŸ„²|Numeric|â†’|
|expr + expr|ğŸ„²|Numeric|â†’|
|expr - expr|ğŸ„²|Numeric|â†’|
|expr expr|æ‹¼æ¥å­—ç¬¦ä¸²|String|â†’|
|expr < expr|ğŸ„²|Numeric|None|
|expr <= expr|ğŸ„²|Numeric|None|
|expr != expr|ğŸ„²|Numeric|None|
|expr == expr|ğŸ„²|Numeric|None|
|expr > expr|ğŸ„²|Numeric|None|
|expr >= expr|ğŸ„²|Numeric|None|
|expr ~ expr|æ­£åˆ™åŒ¹é…|Numeric|None|
|expr !~ expr|æ­£åˆ™ä¸åŒ¹é…|Numeric|None|
|expr in array|æ•°ç»„æˆå‘˜|Numeric|â†’|
|( index ) in array|å¤šç»´æ•°ç»„æˆå‘˜|Numeric|â†’|
|expr && expr|ğŸ„²|Numeric|â†’|
|expr || expr|ğŸ„²|Numeric|â†’|
|expr1 ? expr2 : expr3|ğŸ„²|é€‰ä¸­çš„expr2æˆ–è€…expr3|â†|
|lvalue ^= expr|æŒ‡æ•°è¿ç®—+èµ‹å€¼|Numeric|â†|
|lvalue %= expr|ğŸ„²|Numeric|â†|
|lvalue *= expr|ğŸ„²|Numeric|â†|
|lvalue /= expr|ğŸ„²|Numeric|â†|
|lvalue += expr|ğŸ„²|Numeric|â†|
|lvalue -= expr|ğŸ„²|Numeric|â†|
|lvalue = expr|ğŸ„²|exprç±»å‹|â†|

æŒæ¡AWKåŸºç¡€è¯­æ³•åï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒå˜å¾—æ›´çµæ´»äº›äº†ï¼Œæ¯”å¦‚æŒ‰ç€çŠ¶æ€ä¿å­˜netstatç»“æœï¼š

```bash
$ awk 'NR!=2 {if($6 ~ /TIME|ESTABLISHED/) print > "1.txt";
else if($6 ~/LISTEN/) print > "2.txt";
else print > "3.txt";}' netstat.txt
```

è¿˜å¯ä»¥çµæ´»ç»Ÿè®¡æ–‡ä»¶å¤§å°ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ç»Ÿè®¡æ‰€æœ‰pdfæ–‡ä»¶å¤§å°æ€»å’Œæœ‰å¤šå°‘MBï¼š

```bash
$ find ./ -name '*.pdf' -exec du -ks {} \; | awk '{total=total+$1;} END {print total/1024;}'
98527
```

è¿˜å¯ä»¥ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è¿›ç¨‹å äº†å¤šå°‘MBå†…å­˜ï¼š

```bash
$ ps aux | awk 'NR!=1{a[$1]+=$6;} END {for(i in a) print i ", " a[i]/1024"MB";}'
java_dev, 5263.68MB
dbus, 0.8125MB
polkitd, 7.03125MB
nobody, 88.1875MB
mysql, 756.59MB
ntp, 1.09766MB
root, 844.199MB
```

### å†è¯´BEGINå’ŒEND

å‰é¢ç®€å•ç”¨åˆ°äº†BEGINå’ŒENDä¸¤ä¸ªç‰¹æ®Šæ¨¡å¼ã€‚æ¯ä¸ªBEGINæ¨¡å¼åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå®ƒè¡¨ç¤ºåœ¨è¯»å–ç¬¬ä¸€ä¸ªè¾“å…¥å’Œå‘½ä»¤è¡Œä»»åŠ¡å®Œæˆå‰ã€‚æ¯ä¸ªENDæ¨¡å¼ä¹Ÿæ˜¯åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå®ƒè¡¨ç¤ºè¯»å–æœ€åä¸€ä¸ªè¾“å…¥ä¹‹åã€‚BEGINå’ŒENDä¸èƒ½è”åˆå…¶å®ƒæ¨¡å¼ä½¿ç”¨ã€‚AWKé‡Œå…è®¸ä½¿ç”¨å¤šä¸ªBEGINå’ŒENDï¼Œå®ƒä»¬æ‰§è¡Œæ—¶å°±æŒ‰ç¨‹åºä¸­çš„é¡ºåºè¿›è¡Œã€‚å†™AWKç¨‹åºæ—¶ï¼ŒENDå’ŒBEGINå‰åé¡ºåºä¸å½±å“ENDå’ŒBEGINè§¦å‘æ¡ä»¶ï¼ŒENDç”šè‡³å¯ä»¥å†™åœ¨BEGINä¹‹å‰ã€‚ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰ä¸ªå­¦ç”Ÿæˆç»©è¡¨ï¼š

```bash
$ cat score.txt
2143 å¼ äºŒæ¥ 78 84 77
2321 ç‹é“è›‹ 66 78 85
2122 åˆ˜å¤§å¤´ 88 77 71
2537 æå°èŠ± 87 97 95
2415 èµµæœ‰è´¢ 90 77 62
```

å› ä¸ºè¿™é‡Œçš„AWKä»£ç æ¯”è¾ƒé•¿ï¼Œå†ç›´æ¥å†™åœ¨å‘½ä»¤è¡Œé‡Œæ‰§è¡Œä¼šå˜å¾—æ—¢ä¸æ–¹ä¾¿ï¼Œä¹Ÿéš¾ä»¥è°ƒè¯•ï¼Œæ‰€ä»¥å•ç‹¬å†™ä¸ªAWKè„šæœ¬ï¼Œç„¶åç”¨`-f`å‘½ä»¤æ‰§è¡Œå®ƒã€‚æˆ‘ä»¬çš„AWKè„šæœ¬å¦‚ä¸‹ï¼š

```bash
$ cat cal.awk
#!/bin/awk -f

BEGIN {
    math = 0
    english = 0
    computer = 0
    printf "NO.       å§“å     æ•°å­¦     è‹±è¯­     è¯­æ–‡    æ€»è®¡\n"
    printf "-------------------------------------------------\n"
}

{
    math+=$3
    english+=$4
    words+=$5
    printf "%-6s %-6s %4d %8d %8d %8d\n", $1, $2, $3, $4, $5, $3+$4+$5
}

END {
    printf "-------------------------------------------------\n"
    printf "  TOTAL:%10d %8d %8d \n", math, english, words
    printf "AVERAGE:%10.2f %8.2f %8.2f\n", math/NR, english/NR, words/NR
}
```

å¯ä»¥ç”¨`awk -f`å‘½ä»¤æ‰§è¡Œï¼Œå¦å¤–å› ä¸ºæˆ‘ä»¬awkè„šæœ¬ç¬¬ä¸€è¡Œå†™äº†æ‰§è¡Œå‘½ä»¤ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å…ˆç»™cal.awkèµ‹äºˆå¯æ‰§è¡Œæƒé™ï¼ˆ`chmod +x cal.awk`ï¼‰ï¼Œç„¶ååƒç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ä¸€æ ·æ‰§è¡Œå®ƒã€‚æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š

```bash
$ ./cal.awk score.txt
NO.       å§“å     æ•°å­¦     è‹±è¯­     è¯­æ–‡    æ€»è®¡
-------------------------------------------------
å¼ äºŒæ¥    2143     78       84       77      239
ç‹é“è›‹    2321     66       78       85      229
åˆ˜å¤§å¤´    2122     88       77       71      236
æå°èŠ±    2537     87       97       95      279
èµµæœ‰è´¢    2415     90       77       62      229
-------------------------------------------------
  TOTAL:       409      413      390
AVERAGE:     81.80    82.60    78.00
```

## æ€»ç»“

å¾ˆå¤šç½‘ä¸Šèµ„æ–™è¯´SEDæ˜¯æŒ‰è¡Œå¤„ç†ï¼ŒAWKæ˜¯æŒ‰åˆ—å¤„ç†ï¼Œä½†æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå®ƒä»¬ä¸¤ä¸ªéƒ½æ˜¯æŒ‰è¡Œè¯»å–å†…å®¹ï¼Œä¹Ÿéƒ½å¯ä»¥åšæˆæŒ‰è¡Œ/åˆ—è¾“å‡ºç»“æœï¼Œè¡Œåˆ—å¹¶ä¸æ˜¯æœ¬è´¨åŒºåˆ«ã€‚æˆ‘è®¤ä¸ºSEDçš„ä¼˜åŠ¿æ˜¯æ­£åˆ™ï¼ŒAWKçš„ä¼˜åŠ¿åœ¨æ ¼å¼åŒ–ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦é€šè¿‡**åŒºåŸŸé€‰æ‹©+æ­£åˆ™ç­›é€‰**æŒ‘é€‰å†…å®¹ï¼Œéœ€è¦**å¢åˆ æ”¹æŸ¥**å¤„ç†æ•°æ®ï¼Œé‚£ä¹ˆä¼˜å…ˆè€ƒè™‘ç”¨**SED**ã€‚å¦‚æœæˆ‘ä»¬çš„å·¥ä½œæ¨¡å¼æ˜¯**é¢„å¤„ç†â†’é€è¡Œå¤„ç†â†’æ”¶å°¾å·¥ä½œ**ï¼ŒåŒæ—¶éœ€è¦**æ ¼å¼åŒ–**è¾“å‡ºç»“æœï¼Œè¯·ä¼˜é€‰è€ƒè™‘**AWK**ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç»“åˆç€ç”¨è¿™ä¸¤æ¬¾å·¥å…·ï¼Œç”¨å¥½*uixçš„ç®¡é“å’Œé‡å®šå‘ï¼Œçµæ´»ç»„åˆä½¿ç”¨å„ç±»å·¥å…·ï¼Œæ‰èƒ½æœ€ç»ˆæ–¹ä¾¿æˆ‘ä»¬å·¥ä½œã€‚
